{% extends 'base.html' %}
{% load static %}
{% block title %}Academic Setup{% endblock %}

{% block content %}
  <div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h2>Academic Setup</h2>
    <a href="{% url 'adminpage' %}" class="btn btn-secondary">Go Back</a>
  </div>

  <ul class="nav nav-tabs mt-3">
    <li class="nav-item"><a class="nav-link {% if tab == 'school_year' %}active{% endif %}" href="?tab=school_year">School Year</a></li>
    <li class="nav-item"><a class="nav-link {% if tab == 'subject' %}active{% endif %}" href="?tab=subject">Subjects</a></li>
    <li class="nav-item"><a class="nav-link {% if tab == 'section' %}active{% endif %}" href="?tab=section">Sections</a></li>
    <li class="nav-item"><a class="nav-link {% if tab == 'faculty' %}active{% endif %}" href="?tab=faculty">Faculty Assignment</a></li>
    <li class="nav-item"><a class="nav-link {% if tab == 'grading' %}active{% endif %}" href="?tab=grading">Grading Setup</a></li>
  </ul>

  <div class="mt-3">
    <!-- Action bar -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        {% if tab == 'school_year' %}
          <a href="{% url 'add_school_year' %}" class="btn btn-primary">Add School Year</a>
        {% elif tab == 'subject' %}
          <a href="{% url 'add_subject' %}" class="btn btn-primary">Add Subject</a>
        {% elif tab == 'section' %}
          <a href="{% url 'add_section' %}" class="btn btn-primary">Add Section</a>
        {% elif tab == 'faculty' %}
          <a href="{% url 'add_faculty' %}" class="btn btn-primary">Assign Faculty</a>
        {% elif tab == 'grading' %}
          <a href="{% url 'add_grading' %}" class="btn btn-primary">Add Component</a>
        {% endif %}
      </div>

    </div>

    <hr>
    <h5>Existing Records</h5>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          {% if tab == 'school_year' %}
            <tr><th>Year</th><th>Status</th><th>Actions</th></tr>
          {% elif tab == 'subject' %}
            <tr><th>Code</th><th>Name</th><th>Status</th><th>Actions</th></tr>
          {% elif tab == 'section' %}
            <tr><th>Grade</th><th>Section</th><th>Adviser</th><th>No. Students</th><th>Status</th><th>Actions</th></tr>
          {% elif tab == 'faculty' %}
            <tr><th>Subject</th><th>Faculty</th><th>Status</th><th>Actions</th></tr>
          {% elif tab == 'grading' %}
            <tr><th>Component</th><th>Weight</th><th>Status</th><th>Actions</th></tr>
          {% endif %}
        </thead>
        <tbody>
  {% for obj in objects %}
    <tr>
      {% if tab == 'school_year' %}
        <td>{{ obj.year }}</td>
        <td>{{ obj.status }}</td>
        <td>
          <a href="{% url 'edit_school_year' obj.id %}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{% url 'delete_school_year' obj.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this school year?')">Delete</a>
        </td>
      {% elif tab == 'subject' %}
        <td>{{ obj.code }}</td>
        <td>{{ obj.name }}</td>
        <td>{{ obj.status }}</td>
        <td>
          <a href="{% url 'edit_subject' obj.id %}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{% url 'delete_subject' obj.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this subject?')">Delete</a>
        </td>
      {% elif tab == 'section' %}
        <td>{{ obj.grade }}</td>
        <td>{{ obj.name }}</td>
        <td>{{ obj.adviser }}</td>
        <td>{{ obj.number_of_students }}</td>
        <td>{{ obj.status }}</td>
        <td>
          <a href="{% url 'edit_section' obj.id %}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{% url 'delete_section' obj.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this section?')">Delete</a>
        </td>
    {% elif tab == 'faculty' %}
{% for obj in objects %}
<tr>
  <td>
    {% for sub in obj.subjects.all %}
      {{ sub.name }}{% if not forloop.last %}, {% endif %}
    {% empty %}
      None
    {% endfor %}
  </td>
  <td>{{ obj.faculty.first_name }} {{ obj.faculty.last_name }}</td>
  <td>{{ obj.status }}</td>
  <td>
    <a href="{% url 'edit_faculty' obj.id %}" class="btn btn-sm btn-warning">Edit</a>
    <a href="{% url 'delete_faculty' obj.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this faculty assignment?')">Delete</a>
  </td>
</tr>
{% endfor %}


      {% elif tab == 'grading' %}
        <td>{{ obj.component }}</td>
        <td>{{ obj.weight }}%</td>
        <td>{{ obj.status }}</td>
        <td>
          <a href="{% url 'edit_grading' obj.id %}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{% url 'delete_grading' obj.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this grading component?')">Delete</a>
        </td>
      {% endif %}
    </tr>
  {% empty %}
    <tr><td colspan="6">No records</td></tr>
  {% endfor %}
</tbody>

      </table>
    </div>
  </div>
</div>
{% endblock %}
