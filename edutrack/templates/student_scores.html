{% extends 'base.html' %}
{% block title %}My Scores{% endblock %}

{% block content %}
<style>
    /* Custom Status Badge Styles */
    .status-badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.8rem;
        font-family: Poppins, sans-serif;
        text-align: center;
        white-space: nowrap;
    }
    .status-badge-at-risk {
        background-color: #EF5353;
        color: #FFFFFF;
    }
    .status-badge-average {
        background-color: #F2C454;
        color: #1E1E1E;
    }
    .status-badge-good {
        background-color: #B9E76B;
        color: #1E1E1E;
    }
    .status-badge-excellent {
        background-color: #F39E4D;
        color: #FFFFFF;
    }
</style>
<div class="container mt-4">
  <h1>My Scores</h1>
  <a href="{% url 'student_dashboard' %}" class="btn btn-secondary mb-3">Back to Dashboard</a>
  
  {% if student_record %}
  {% if student_subjects %}
    {% for subject_data in student_subjects %}
      {% if subject_data.performance_category == 'At Risk' %}
        <div class="alert alert-danger">
          <strong><i class="fas fa-exclamation-triangle"></i> At Risk Alert:</strong> 
          Your grade in <strong>{{ subject_data.subject.name }}</strong> is below 70. Please seek help from your teacher.
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Subject</th>
          <th>Quiz Average</th>
          <th>Exam Average</th>
          <th>Project Average</th>
          <th>Attendance %</th>
          <th>Overall Grade</th>
        </tr>
      </thead>
      <tbody>
        {% for subject_data in student_subjects %}
        <tr>
          <td><strong>{{ subject_data.subject.name }} ({{ subject_data.subject.code }})</strong></td>
          <td>
            {% if subject_data.quiz_average %}
              {{ subject_data.quiz_average|floatformat:2 }}
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>
            {% if subject_data.exam_average %}
              {{ subject_data.exam_average|floatformat:2 }}
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>
            {% if subject_data.project_average %}
              {{ subject_data.project_average|floatformat:2 }}
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>
            {% if subject_data.attendance_average %}
              {{ subject_data.attendance_average|floatformat:2 }}%
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>
            {% if subject_data.grade %}
              <strong>{{ subject_data.grade|floatformat:2 }}</strong>
              {% if subject_data.performance_category %}
                <br>
                {% if subject_data.performance_category == 'At Risk' %}
                  <span class="status-badge status-badge-at-risk">At Risk</span>
                {% elif subject_data.performance_category == 'Average' %}
                  <span class="status-badge status-badge-average">Average</span>
                {% elif subject_data.performance_category == 'Good' %}
                  <span class="status-badge status-badge-good">Good</span>
                {% elif subject_data.performance_category == 'Excellent' %}
                  <span class="status-badge status-badge-excellent">Excellent</span>
                {% endif %}
              {% endif %}
            {% else %}
              <span class="text-muted">-</span>
              {% endif %}
          </td>
          <td>
            {% if subject_data.performance_category %}
              {% if subject_data.performance_category == 'At Risk' %}
                <span class="status-badge status-badge-at-risk">At Risk</span>
              {% elif subject_data.performance_category == 'Average' %}
                <span class="status-badge status-badge-average">Average</span>
              {% elif subject_data.performance_category == 'Good' %}
                <span class="status-badge status-badge-good">Good</span>
              {% elif subject_data.performance_category == 'Excellent' %}
                <span class="status-badge status-badge-excellent">Excellent</span>
              {% endif %}
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center">No scores available yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="alert alert-warning">
    <p>Student record not found. Please contact the administrator.</p>
  </div>
  {% endif %}
</div>
{% endblock %}

